<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›»è©±è™Ÿç¢¼å‘½ç†åˆ†æç³»çµ± - ç´”å‰ç«¯ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 700px;
            width: 100%;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #667eea;
            font-size: 28px;
            margin-bottom: 8px;
        }

        .header p {
            color: #666;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #333;
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .result {
            margin-top: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            display: none;
        }

        .result.show {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result h2 {
            color: #667eea;
            font-size: 20px;
            margin-bottom: 15px;
            text-align: center;
        }

        .result-content {
            white-space: pre-wrap;
            font-family: 'Consolas', monospace;
            font-size: 13px;
            line-height: 1.5;
            color: #333;
            background: white;
            padding: 15px;
            border-radius: 6px;
            max-height: 450px;
            overflow-y: auto;
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 12px;
            border-radius: 6px;
            margin-top: 12px;
            display: none;
        }

        .error.show {
            display: block;
            animation: shake 0.5s;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-8px);
            }

            75% {
                transform: translateX(8px);
            }
        }

        .info-box {
            background: #e3f2fd;
            border-left: 3px solid #2196f3;
            padding: 12px;
            margin-bottom: 20px;
            border-radius: 4px;
            font-size: 13px;
            color: #1976d2;
        }

        .download-btn {
            margin-top: 12px;
            padding: 8px 16px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
        }

        .download-btn:hover {
            background: #45a049;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“± é›»è©±è™Ÿç¢¼å‘½ç†åˆ†æ</h1>
            <p>å…«å¤§æ•¸å­—ç£å ´ Ã— å…«åä¸€éˆå‹•æ•¸ Ã— äº”è¡Œç›¸å®¹æ€§</p>
        </div>

        <div class="info-box">
            ğŸ’¡ ç´”å‰ç«¯ç‰ˆæœ¬ - ç„¡éœ€å®‰è£,ç„¡éœ€å¾Œç«¯,ç›´æ¥åœ¨ç€è¦½å™¨ä¸­åˆ†æ!
        </div>

        <form id="analysisForm">
            <div class="form-group">
                <label for="phoneNumber">ğŸ“ æ‰‹æ©Ÿè™Ÿç¢¼</label>
                <input type="text" id="phoneNumber" placeholder="ä¾‹: 0978-759-196 æˆ– 0978759196" required>
            </div>

            <div class="form-group">
                <label for="birthdate">ğŸ‚ å‡ºç”Ÿå¹´æœˆæ—¥ (è¥¿å…ƒ)</label>
                <input type="text" id="birthdate" placeholder="æ ¼å¼: YYYY/MM/DD (ä¾‹: 1990/09/25)" required>
            </div>

            <button type="submit" class="btn">ğŸ”® é–‹å§‹åˆ†æ</button>
        </form>

        <div class="error" id="errorMsg"></div>

        <div class="result" id="result">
            <h2>ğŸ“Š åˆ†æçµæœ</h2>
            <div class="result-content" id="resultContent"></div>
            <button class="download-btn" onclick="downloadReport()">ğŸ’¾ ä¸‹è¼‰å ±å‘Š</button>
        </div>
    </div>

    <script>
        // é›»è©±è™Ÿç¢¼å‘½ç†åˆ†æ JavaScript ç‰ˆæœ¬
        class PhoneNumerology {
            constructor(birthdate) {
                const [year, month, day] = birthdate.split('/').map(Number);
                this.birthdate = birthdate;
                this.birthYear = year;
                this.birthMonth = month;
                this.birthDay = day;
            }

            // å…«å¤§æ•¸å­—ç£å ´å®šç¾©
            static MAGNETIC_FIELDS = {
                'å¤©é†«': { pairs: ['13', '31', '68', '86', '49', '94', '27', '72'], meaning: 'è²¡å¯Œã€æ™ºæ…§ã€æ­£æ¡ƒèŠ±ã€å©šå§»', score: 10, type: 'lucky' },
                'ç”Ÿæ°£': { pairs: ['14', '41', '67', '76', '93', '39', '82', '28'], meaning: 'è²´äººã€æ¨‚å¤©ã€äººéš›é—œä¿‚', score: 9, type: 'lucky' },
                'å»¶å¹´': { pairs: ['19', '91', '87', '78', '34', '43', '26', '62'], meaning: 'äº‹æ¥­ã€å°ˆæ¥­èƒ½åŠ›ã€é ˜å°åŠ›', score: 9, type: 'lucky' },
                'ä¼ä½': { pairs: ['11', '22', '33', '44', '55', '66', '77', '88', '99'], meaning: 'ç­‰å¾…ã€è“„å‹¢å¾…ç™¼', score: 5, type: 'neutral' },
                'çµ•å‘½': { pairs: ['12', '21', '69', '96', '48', '84', '37', '73'], meaning: 'æŠ•è³‡ã€å†’éšªã€å£“åŠ›', score: -8, type: 'unlucky' },
                'ç¦å®³': { pairs: ['17', '71', '89', '98', '46', '64', '32', '23'], meaning: 'å£èˆŒæ˜¯éã€å°äºº', score: -7, type: 'unlucky' },
                'äº”é¬¼': { pairs: ['18', '81', '97', '79', '36', '63', '24', '42'], meaning: 'è°æ˜ã€æ©Ÿæ™ºä½†æ˜“æœ‰æ„å¤–', score: -6, type: 'unlucky' },
                'å…­ç…': { pairs: ['16', '61', '74', '47', '38', '83', '29', '92'], meaning: 'æ¡ƒèŠ±ã€æ„Ÿæƒ…æ³¢æŠ˜', score: -5, type: 'unlucky' }
            };

            // å…«åä¸€éˆå‹•æ•¸å°ç…§è¡¨ (ç°¡åŒ–ç‰ˆ,åŒ…å«ä¸»è¦æ•¸å­—)
            static LINGDONG_81 = {
                1: { type: 'å¤§å‰', meaning: 'å®‡å®™èµ·æº,å¤©åœ°é–‹æ³°', score: 10 }, 3: { type: 'å¤§å‰', meaning: 'é€²å–å¦‚æ„,å¢é€²ç¹æ¦®', score: 10 },
                5: { type: 'å¤§å‰', meaning: 'ç¦ç¥¿é•·å£½,ç¦å¾·é›†é–€', score: 10 }, 6: { type: 'å‰', meaning: 'å®‰ç©©é¤˜æ…¶,å‰äººå¤©ç›¸', score: 8 },
                7: { type: 'å‰', meaning: 'å‰›æ¯…æœæ–·,å‹‡å¾€ç›´å‰', score: 8 }, 8: { type: 'å‰', meaning: 'æ„å¿—å‰›å¥,å‹¤å‹‰ç™¼å±•', score: 8 },
                11: { type: 'å¤§å‰', meaning: 'ç©©å¥å‰æ…¶,å¯Œè²´æ¦®é”', score: 10 }, 13: { type: 'å¤§å‰', meaning: 'æ™ºç•¥è¶…ç¾¤,åšå­¸å¤šæ‰', score: 10 },
                15: { type: 'å¤§å‰', meaning: 'ç¦å£½é›™å…¨,ç«‹èº«èˆˆå®¶', score: 10 }, 16: { type: 'å¤§å‰', meaning: 'è²´äººç›¸åŠ©,èˆˆå®¶èˆˆæ¥­', score: 10 },
                17: { type: 'å‰', meaning: 'çªç ´è¬é›£,å‰›æŸ”å…¼å‚™', score: 8 }, 18: { type: 'å‰', meaning: 'æœ‰å¿—ç«Ÿæˆ,å…§åæœ‰é‹', score: 8 },
                21: { type: 'å¤§å‰', meaning: 'ç¨ç«‹æ¬Šå¨,æ˜æœˆå…‰ç…§', score: 10 }, 23: { type: 'å¤§å‰', meaning: 'æ—­æ—¥æ±å‡,è³ªå¯¦å‰›å …', score: 10 },
                24: { type: 'å¤§å‰', meaning: 'å®¶é–€é¤˜æ…¶,é‡‘éŒ¢è±ç›ˆ', score: 10 }, 25: { type: 'å‰', meaning: 'è‹±ä¿Šå‰›æ¯…,è³‡æ€§è°æ•', score: 8 },
                31: { type: 'å¤§å‰', meaning: 'æ™ºå‹‡å¾—å¿—,å¿ƒæƒ³äº‹æˆ', score: 10 }, 32: { type: 'å¤§å‰', meaning: 'æ¬Šè²´é¡¯é”,æ„å¤–æƒ æ¾¤', score: 10 },
                33: { type: 'å¤§å‰', meaning: 'å®¶é–€éš†æ˜Œ,æ‰å¾·é–‹å±•', score: 10 }, 35: { type: 'å‰', meaning: 'æº«å’Œå¹³éœ,æ™ºé”é€šæš¢', score: 8 },
                37: { type: 'å‰', meaning: 'æ¬Šå¨é¡¯é”,å‰äººå¤©ç›¸', score: 8 }, 39: { type: 'å¤§å‰', meaning: 'å¯Œè²´æ¦®è¯,è®ŠåŒ–ç„¡çª®', score: 10 },
                41: { type: 'å¤§å‰', meaning: 'å¾·é«˜æœ›é‡,äº‹äº‹å¦‚æ„', score: 10 }, 45: { type: 'å¤§å‰', meaning: 'é †é¢¨æšå¸†,è¬äº‹å¦‚æ„', score: 10 },
                47: { type: 'å¤§å‰', meaning: 'é»éµæˆé‡‘,é–‹èŠ±çµæœ', score: 10 }, 48: { type: 'å‰', meaning: 'æ™ºè¬€å…¼å‚™,å¾·é‡æ¦®é”', score: 8 },
                52: { type: 'å‰', meaning: 'è‰æœ¨é€¢æ˜¥,é›¨éå¤©æ™´', score: 7 }, 57: { type: 'å‰', meaning: 'å¯’é›ªé’æ¾,æ™šå¹´æ˜Œéš†', score: 7 },
                61: { type: 'å‰', meaning: 'ååˆ©é›™æ”¶,ç¹æ¦®å¯Œè²´', score: 8 }, 63: { type: 'å‰', meaning: 'è¬ç‰©åŒ–è‚²,ç¹æ¦®ä¹‹è±¡', score: 8 },
                65: { type: 'å¤§å‰', meaning: 'å‰é‹è‡ªä¾†,èƒ½äº«ç››å', score: 10 }, 67: { type: 'å¤§å‰', meaning: 'å¯Œè²´é•·å£½,å…‰æ˜æ­£å¤§', score: 10 },
                68: { type: 'å‰', meaning: 'æ€æ…®å‘¨è©³,è¨ˆåŠƒåŠ›è¡Œ', score: 8 }, 81: { type: 'å¤§å‰', meaning: 'è¬ç‰©å›æ˜¥,é‚„åŸå¾©å§‹', score: 10 },
                2: { type: 'å‡¶', meaning: 'æ··é£©æœªå®š,åˆ†é›¢ç ´æ•—', score: -5 }, 4: { type: 'å‡¶', meaning: 'ç ´æ•—å‡¶è®Š,è¬äº‹ä¼‘æ­¢', score: -8 },
                9: { type: 'å‡¶', meaning: 'èˆˆç›¡å‡¶å§‹,çª®ä¹å›°è‹¦', score: -8 }, 10: { type: 'å‡¶', meaning: 'è¬äº‹çµ‚å±€,å……æ»¿æè€—', score: -8 },
                12: { type: 'å‡¶', meaning: 'æ„å¿—è–„å¼±,å®¶åº­å¯‚å¯', score: -5 }, 14: { type: 'å‡¶', meaning: 'æ·ªè½å¤©æ¶¯,å¤±æ„ç…©æ‚¶', score: -5 },
                19: { type: 'å‡¶', meaning: 'é¢¨é›²è”½æœˆ,ç½è‹¦é‡ä¾†', score: -7 }, 20: { type: 'å‡¶', meaning: 'éæ¥­ç ´é‹,ç½ç¦ä¸å®‰', score: -7 },
                22: { type: 'å‡¶', meaning: 'ç§‹è‰é€¢éœœ,å…©å£«ç›¸çˆ­', score: -5 }, 26: { type: 'å‡¶', meaning: 'æ³¢ç€¾é‡ç–Š,è®Šæ€ªå¥‡ç•°', score: -4 },
                27: { type: 'å‰å¸¶å‡¶', meaning: 'è¶³æ™ºå¤šè¬€,å…ˆè‹¦å¾Œç”œ', score: 3 }, 28: { type: 'å‡¶', meaning: 'å®¶è¦ªç·£è–„,é›¢ç¾¤ç¨è™•', score: -6 },
                29: { type: 'å‰', meaning: 'æ™ºè¬€å…¼å‚™,æ¬²æœ›é›£è¶³', score: 7 }, 30: { type: 'å‰å¸¶å‡¶', meaning: 'ä¸€æˆä¸€æ•—,çµ•è™•é€¢ç”Ÿ', score: 3 },
                34: { type: 'å‡¶', meaning: 'ç ´å®¶äº¡èº«,è²¡å‘½å±éšª', score: -8 }, 36: { type: 'å‡¶', meaning: 'é¢¨æµªä¸æ¯,ä¿ ç¾©è–„é‹', score: -5 },
                40: { type: 'å‰å¸¶å‡¶', meaning: 'è¬¹æ…ä¿å®‰,è±ªè†½é‚é€²', score: 3 }, 42: { type: 'å‰å¸¶å‡¶', meaning: 'å¯’å¬‹åœ¨æŸ³,åè—ä¸æˆ', score: 2 },
                43: { type: 'å‡¶å¸¶å‰', meaning: 'é‚ªé€”æ•£è²¡,å¤–ç¥¥å…§è‹¦', score: -2 }, 44: { type: 'å‡¶', meaning: 'é ˆçœ‰é›£å±•,åŠ›é‡æœ‰é™', score: -6 },
                46: { type: 'å‡¶', meaning: 'ç¾…ç¶²ç¹«èº«,é›¢ç¥–æˆå®¶', score: -5 }, 49: { type: 'å‰å¸¶å‡¶', meaning: 'å‰å‡¶é›£åˆ†,ä¸æ–·è¾›å‹', score: 2 },
                50: { type: 'å‰å¸¶å‡¶', meaning: 'å°èˆŸå…¥æµ·,å‰å‡¶åƒåŠ', score: 2 }, 51: { type: 'å‰å¸¶å‡¶', meaning: 'ä¸€ç››ä¸€è¡°,æµ®æ²‰ä¸å®š', score: 2 },
                53: { type: 'å‰å¸¶å‡¶', meaning: 'å¤–ç¥¥å…§æ‚£,å…ˆå‰å¾Œå‡¶', score: 1 }, 54: { type: 'å‡¶', meaning: 'é›–å‚¾å…¨åŠ›,é›£æœ›æˆåŠŸ', score: -6 },
                55: { type: 'å‰å¸¶å‡¶', meaning: 'å¤–ç¾å…§è‹¦,å‡é¢ç¹æ¦®', score: 1 }, 56: { type: 'å‡¶', meaning: 'ç¼ºä¹å¯¦è¡Œ,é›£æœ›æˆåŠŸ', score: -5 },
                58: { type: 'å‰å¸¶å‡¶', meaning: 'å…ˆè‹¦å¾Œç”˜,æµ®æ²‰å¤šç«¯', score: 2 }, 59: { type: 'å‡¶', meaning: 'é‡äº‹çŒ¶ç–‘,é›£æœ›æˆåŠŸ', score: -6 },
                60: { type: 'å‡¶', meaning: 'é»‘æš—ç„¡å…‰,å¿ƒè¿·æ„äº‚', score: -7 }, 62: { type: 'å‡¶', meaning: 'åŸºç¤è™›å¼±,æ–æ–æ¬²å¢œ', score: -6 },
                64: { type: 'å‡¶', meaning: 'éª¨è‚‰åˆ†é›¢,å­¤å…’æ‚²æ„', score: -7 }, 66: { type: 'å‡¶', meaning: 'å…§å¤–ä¸å’Œ,ä¿¡ç”¨ç¼ºä¹', score: -5 },
                69: { type: 'å‡¶', meaning: 'å‹•æ–ä¸å®‰,å¸¸é™·é€†å¢ƒ', score: -6 }, 70: { type: 'å‡¶', meaning: 'æ…˜æ·¡ç¶“ç‡Ÿ,é›£å…è²§å›°', score: -7 },
                71: { type: 'å‰å¸¶å‡¶', meaning: 'å‰å‡¶åƒåŠ,æƒŸè³´å‹‡æ°£', score: 2 }, 72: { type: 'å‰å¸¶å‡¶', meaning: 'å…ˆç”˜å¾Œè‹¦,ä¸èƒ½æŒä¹…', score: 1 },
                73: { type: 'å‰å¸¶å‡¶', meaning: 'ç››è¡°äº¤åŠ ,å¯å®ˆæˆåŠŸ', score: 2 }, 74: { type: 'å‡¶', meaning: 'æ™ºèƒ½ä¸è¶³,åé£Ÿå±±ç©º', score: -6 },
                75: { type: 'å‰å¸¶å‡¶', meaning: 'å…ˆå‰å¾Œå‡¶,é€€å®ˆå¯å®‰', score: 1 }, 76: { type: 'å‡¶å¸¶å‰', meaning: 'å‚¾è¦†é›¢æ•£,éª¨è‚‰åˆ†é›¢', score: -3 },
                77: { type: 'å‰å¸¶å‡¶', meaning: 'å…ˆè‹¦å¾Œç”˜,ä¸å¯å€‰ä¿ƒ', score: 2 }, 78: { type: 'å‰å¸¶å‡¶', meaning: 'æœ‰å¾—æœ‰å¤±,è¯è€Œä¸å¯¦', score: 1 },
                79: { type: 'å‡¶', meaning: 'æŒ½å›ä¹åŠ›,èº«ç–²åŠ›ç›¡', score: -7 }, 80: { type: 'å‡¶', meaning: 'å‡¶æ˜Ÿå…¥åº¦,æ¸…æœ¬ç¸®å°', score: -7 }
            };

            analyzeMagneticFields(phoneNumber) {
                const clean = phoneNumber.replace(/\D/g, '');
                const pairs = [];
                for (let i = 0; i < clean.length - 1; i++) {
                    pairs.push(clean.substring(i, i + 2));
                }

                const fieldCounts = {};
                const fieldDetails = [];
                let totalScore = 0;

                for (const pair of pairs) {
                    for (const [fieldName, fieldInfo] of Object.entries(PhoneNumerology.MAGNETIC_FIELDS)) {
                        if (fieldInfo.pairs.includes(pair)) {
                            fieldCounts[fieldName] = (fieldCounts[fieldName] || 0) + 1;
                            fieldDetails.push({ pair, field: fieldName, meaning: fieldInfo.meaning, type: fieldInfo.type, score: fieldInfo.score });
                            totalScore += fieldInfo.score;
                            break;
                        }
                    }
                }

                return { pairs, fieldCounts, fieldDetails, totalScore, averageScore: pairs.length ? totalScore / pairs.length : 0 };
            }

            calculateLingdong81(phoneNumber) {
                const clean = phoneNumber.replace(/\D/g, '');
                const lastDigits = clean.slice(-4);
                const numberValue = parseInt(lastDigits);
                const lingdongNum = (numberValue % 80) || 80;
                const lingdongInfo = PhoneNumerology.LINGDONG_81[lingdongNum] || { type: 'æœªçŸ¥', meaning: 'ç„¡è³‡æ–™', score: 0 };

                return { lastDigits, numberValue, lingdongNumber: lingdongNum, ...lingdongInfo };
            }

            calculateFiveElements(phoneNumber) {
                const heavenlyStems = ['åºš', 'è¾›', 'å£¬', 'ç™¸', 'ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±'];
                const elementsMap = { 'åºš': 'é‡‘', 'è¾›': 'é‡‘', 'å£¬': 'æ°´', 'ç™¸': 'æ°´', 'ç”²': 'æœ¨', 'ä¹™': 'æœ¨', 'ä¸™': 'ç«', 'ä¸': 'ç«', 'æˆŠ': 'åœŸ', 'å·±': 'åœŸ' };
                const yearIndex = (this.birthYear - 4) % 10;
                const birthElement = elementsMap[heavenlyStems[yearIndex]];

                const digitElements = { '1': 'æœ¨', '2': 'æœ¨', '3': 'ç«', '4': 'ç«', '5': 'åœŸ', '6': 'åœŸ', '7': 'é‡‘', '8': 'é‡‘', '9': 'æ°´', '0': 'æ°´' };
                const elementRelations = {
                    'æœ¨': { ç”Ÿ: 'ç«', å‰‹: 'åœŸ', è¢«ç”Ÿ: 'æ°´', è¢«å‰‹: 'é‡‘' }, 'ç«': { ç”Ÿ: 'åœŸ', å‰‹: 'é‡‘', è¢«ç”Ÿ: 'æœ¨', è¢«å‰‹: 'æ°´' },
                    'åœŸ': { ç”Ÿ: 'é‡‘', å‰‹: 'æ°´', è¢«ç”Ÿ: 'ç«', è¢«å‰‹: 'æœ¨' }, 'é‡‘': { ç”Ÿ: 'æ°´', å‰‹: 'æœ¨', è¢«ç”Ÿ: 'åœŸ', è¢«å‰‹: 'ç«' },
                    'æ°´': { ç”Ÿ: 'æœ¨', å‰‹: 'ç«', è¢«ç”Ÿ: 'é‡‘', è¢«å‰‹: 'åœŸ' }
                };

                const clean = phoneNumber.replace(/\D/g, '');
                const elementCounts = {};
                for (const digit of clean) {
                    const elem = digitElements[digit];
                    elementCounts[elem] = (elementCounts[elem] || 0) + 1;
                }

                let compatibilityScore = 0;
                const elementAnalysis = [];
                for (const [element, count] of Object.entries(elementCounts)) {
                    let score, relation;
                    if (element === birthElement) { score = 5 * count; relation = 'åŒ'; }
                    else if (element === elementRelations[birthElement].ç”Ÿ) { score = 3 * count; relation = 'æˆ‘ç”Ÿ'; }
                    else if (element === elementRelations[birthElement].è¢«ç”Ÿ) { score = 8 * count; relation = 'ç”Ÿæˆ‘'; }
                    else if (element === elementRelations[birthElement].å‰‹) { score = 2 * count; relation = 'æˆ‘å‰‹'; }
                    else { score = -3 * count; relation = 'å‰‹æˆ‘'; }
                    compatibilityScore += score;
                    elementAnalysis.push({ element, count, relation, score });
                }

                return { birthYear: this.birthYear, birthElement, elementCounts, elementAnalysis, compatibilityScore };
            }

            comprehensiveAnalysis(phoneNumber) {
                const magnetic = this.analyzeMagneticFields(phoneNumber);
                const lingdong = this.calculateLingdong81(phoneNumber);
                const fiveElements = this.calculateFiveElements(phoneNumber);

                const magneticNormalized = (magnetic.averageScore + 10) / 20 * 100;
                const lingdongNormalized = (lingdong.score + 10) / 20 * 100;
                const elementsNormalized = Math.min(100, Math.max(0, fiveElements.compatibilityScore));

                const finalScore = magneticNormalized * 0.4 + lingdongNormalized * 0.3 + elementsNormalized * 0.3;

                let recommendation;
                if (finalScore >= 80) recommendation = 'â˜…â˜…â˜…â˜…â˜… æ¥µåŠ›æ¨è–¦';
                else if (finalScore >= 70) recommendation = 'â˜…â˜…â˜…â˜…â˜† éå¸¸é©åˆ';
                else if (finalScore >= 60) recommendation = 'â˜…â˜…â˜…â˜†â˜† é©åˆ';
                else if (finalScore >= 50) recommendation = 'â˜…â˜…â˜†â˜†â˜† æ™®é€š';
                else recommendation = 'â˜…â˜†â˜†â˜†â˜† ä¸æ¨è–¦';

                return { phoneNumber, birthdate: this.birthdate, magneticFields: magnetic, lingdong81: lingdong, fiveElements, finalScore: Math.round(finalScore * 100) / 100, recommendation };
            }

            generateReport(phoneNumber) {
                const analysis = this.comprehensiveAnalysis(phoneNumber);
                let report = `${'='.repeat(60)}\né›»è©±è™Ÿç¢¼å‘½ç†åˆ†æå ±å‘Š\n${'='.repeat(60)}\n\n`;
                report += `ğŸ“± è™Ÿç¢¼: ${analysis.phoneNumber}\nğŸ‚ å‡ºç”Ÿæ—¥æœŸ: ${analysis.birthdate}\n\n`;
                report += `${'â”€'.repeat(60)}\nã€å…«å¤§æ•¸å­—ç£å ´åˆ†æã€‘\n${'â”€'.repeat(60)}\n`;

                const fieldCounts = analysis.magneticFields.fieldCounts;
                if (Object.keys(fieldCounts).length > 0) {
                    const sorted = Object.entries(fieldCounts).sort((a, b) => b[1] - a[1]);
                    for (const [fieldName, count] of sorted) {
                        const fieldInfo = PhoneNumerology.MAGNETIC_FIELDS[fieldName];
                        report += `  â€¢ ${fieldName} (${fieldInfo.type}): å‡ºç¾ ${count} æ¬¡\n    æ„ç¾©: ${fieldInfo.meaning}\n`;
                    }
                } else {
                    report += '  ç„¡ç‰¹æ®Šç£å ´çµ„åˆ\n';
                }

                report += `\n  ç£å ´è©•åˆ†: ${analysis.magneticFields.totalScore.toFixed(1)}\n\n`;
                report += `${'â”€'.repeat(60)}\nã€å…«åä¸€éˆå‹•æ•¸åˆ†æã€‘\n${'â”€'.repeat(60)}\n`;
                report += `  æœ«å››ç¢¼: ${analysis.lingdong81.lastDigits}\n  éˆå‹•æ•¸: ${analysis.lingdong81.lingdongNumber}\n`;
                report += `  å‰å‡¶: ${analysis.lingdong81.type}\n  æ„ç¾©: ${analysis.lingdong81.meaning}\n  è©•åˆ†: ${analysis.lingdong81.score}\n\n`;
                report += `${'â”€'.repeat(60)}\nã€äº”è¡Œç›¸å®¹æ€§åˆ†æã€‘\n${'â”€'.repeat(60)}\n`;
                report += `  å‡ºç”Ÿå¹´ä»½: ${analysis.fiveElements.birthYear} å¹´\n  æœ¬å‘½äº”è¡Œ: ${analysis.fiveElements.birthElement}\n\n  è™Ÿç¢¼äº”è¡Œåˆ†å¸ƒ:\n`;

                for (const elem of analysis.fiveElements.elementAnalysis) {
                    report += `    ${elem.element}: ${elem.count} å€‹ (${elem.relation}) - å¾—åˆ†: ${elem.score}\n`;
                }

                report += `\n  äº”è¡Œç›¸å®¹è©•åˆ†: ${analysis.fiveElements.compatibilityScore}\n\n`;
                report += `${'='.repeat(60)}\nã€ç¶œåˆè©•åˆ†ã€‘\n${'='.repeat(60)}\n`;
                report += `  ç¸½åˆ†: ${analysis.finalScore}/100\n  æ¨è–¦åº¦: ${analysis.recommendation}\n${'='.repeat(60)}\n`;

                return report;
            }
        }

        // UI æ§åˆ¶
        let currentReport = '';

        document.getElementById('analysisForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const phoneNumber = document.getElementById('phoneNumber').value.trim();
            const birthdate = document.getElementById('birthdate').value.trim();

            if (!validateInputs(phoneNumber, birthdate)) return;

            document.getElementById('errorMsg').classList.remove('show');
            document.getElementById('result').classList.remove('show');

            try {
                const analyzer = new PhoneNumerology(birthdate);
                const report = analyzer.generateReport(phoneNumber);

                currentReport = report;
                document.getElementById('resultContent').textContent = report;
                document.getElementById('result').classList.add('show');
            } catch (error) {
                showError('åˆ†æéç¨‹ç™¼ç”ŸéŒ¯èª¤: ' + error.message);
            }
        });

        function validateInputs(phoneNumber, birthdate) {
            if (!/^09\d{2}[-]?\d{3}[-]?\d{3}$/.test(phoneNumber)) {
                showError('æ‰‹æ©Ÿè™Ÿç¢¼æ ¼å¼ä¸æ­£ç¢º,è«‹è¼¸å…¥ 09 é–‹é ­çš„ 10 ä½æ•¸å­—');
                return false;
            }
            if (!/^\d{4}\/\d{2}\/\d{2}$/.test(birthdate)) {
                showError('å‡ºç”Ÿæ—¥æœŸæ ¼å¼ä¸æ­£ç¢º,è«‹ä½¿ç”¨ YYYY/MM/DD æ ¼å¼');
                return false;
            }
            const [year, month, day] = birthdate.split('/').map(Number);
            if (year < 1900 || year > 2100 || month < 1 || month > 12 || day < 1 || day > 31) {
                showError('å‡ºç”Ÿæ—¥æœŸæ•¸å€¼ä¸æ­£ç¢º');
                return false;
            }
            return true;
        }

        function showError(message) {
            const errorMsg = document.getElementById('errorMsg');
            errorMsg.textContent = 'âŒ ' + message;
            errorMsg.classList.add('show');
            setTimeout(() => errorMsg.classList.remove('show'), 5000);
        }

        function downloadReport() {
            const blob = new Blob([currentReport], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            const phoneNumber = document.getElementById('phoneNumber').value.replace(/\D/g, '');
            a.href = url;
            a.download = `${phoneNumber}_åˆ†æå ±å‘Š.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // è‡ªå‹•æ ¼å¼åŒ–
        document.getElementById('phoneNumber').addEventListener('input', (e) => {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 10) value = value.slice(0, 10);
            if (value.length >= 7) e.target.value = value.slice(0, 4) + '-' + value.slice(4, 7) + '-' + value.slice(7);
            else if (value.length >= 4) e.target.value = value.slice(0, 4) + '-' + value.slice(4);
            else e.target.value = value;
        });

        document.getElementById('birthdate').addEventListener('input', (e) => {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 8) value = value.slice(0, 8);
            if (value.length >= 6) e.target.value = value.slice(0, 4) + '/' + value.slice(4, 6) + '/' + value.slice(6);
            else if (value.length >= 4) e.target.value = value.slice(0, 4) + '/' + value.slice(4);
            else e.target.value = value;
        });
    </script>
</body>

</html>